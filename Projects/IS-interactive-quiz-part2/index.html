<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intelligent Systems: Exam Mastery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Rajdhani:wght@500;700&display=swap');

        :root {
            --neon-blue: #00f3ff;
            --neon-green: #0aff0a;
            --neon-red: #ff003c;
            --bg-dark: #050510;
            --card-bg: #0f1020;
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background-color: var(--bg-dark);
            color: white;
            overflow-x: hidden;
            background-image: 
                linear-gradient(rgba(0, 243, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 243, 255, 0.03) 1px, transparent 1px);
            background-size: 30px 30px;
        }

        .mono { font-family: 'JetBrains Mono', monospace; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--neon-blue); }

        /* Animations */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 10px rgba(0, 243, 255, 0.2); }
            50% { box-shadow: 0 0 20px rgba(0, 243, 255, 0.6); }
        }

        @keyframes slide-in {
            from { opacity: 0; transform: translateX(50px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes pop-in {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }

        @keyframes glitch-anim {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }

        .animate-slide-in { animation: slide-in 0.4s ease-out forwards; }
        .animate-pop { animation: pop-in 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        .glitch { animation: glitch-anim 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) both infinite; }

        /* Components */
        .neon-border {
            box-shadow: 0 0 5px var(--neon-blue), inset 0 0 5px var(--neon-blue);
            border: 1px solid var(--neon-blue);
        }
        
        .neon-text {
            text-shadow: 0 0 10px var(--neon-blue);
        }

        .option-btn {
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .option-btn:hover:not(:disabled) {
            background: rgba(0, 243, 255, 0.1);
            border-color: var(--neon-blue);
            transform: translateX(5px);
        }

        .option-btn.correct {
            background: rgba(10, 255, 10, 0.2);
            border-color: var(--neon-green);
            box-shadow: 0 0 15px rgba(10, 255, 10, 0.4);
        }

        .option-btn.wrong {
            background: rgba(255, 0, 60, 0.2);
            border-color: var(--neon-red);
            box-shadow: 0 0 15px rgba(255, 0, 60, 0.4);
        }

        .progress-fill {
            transition: width 0.5s ease-in-out;
            box-shadow: 0 0 10px var(--neon-blue);
        }

        .hidden-screen { display: none; }
        
        .glass-panel {
            background: rgba(15, 16, 32, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

    </style>
</head>
<body class="h-screen flex flex-col">

    <!-- Background Animated Elements -->
    <div class="fixed inset-0 pointer-events-none z-0 opacity-20">
        <div class="absolute top-10 left-10 w-32 h-32 border border-cyan-500 rounded-full animate-[pulse-glow_3s_infinite]"></div>
        <div class="absolute bottom-20 right-20 w-48 h-48 border border-purple-500 rounded-full animate-[pulse-glow_4s_infinite_reverse]"></div>
    </div>

    <!-- START SCREEN -->
    <div id="start-screen" class="flex-1 flex flex-col items-center justify-center z-10 p-6 relative">
        <div class="glass-panel p-12 rounded-2xl border-t-4 border-cyan-400 shadow-2xl text-center max-w-2xl w-full animate-pop">
            <div class="mb-6 text-cyan-400 text-6xl"><i class="fas fa-brain"></i></div>
            <h1 class="text-5xl font-bold mb-2 tracking-wider uppercase neon-text">System Override</h1>
            <h2 class="text-xl text-gray-400 mb-8 mono">Intelligent Systems Exam Prep Protocol</h2>
            
            <div class="flex flex-col gap-4 mb-8">
                <div class="flex items-center justify-between bg-gray-900/50 p-3 rounded border border-gray-700">
                    <span class="text-gray-400"><i class="fas fa-book mr-2"></i>Modules</span>
                    <span class="text-cyan-400 font-bold">Lessons 6, 7, & 8</span>
                </div>
                <div class="flex items-center justify-between bg-gray-900/50 p-3 rounded border border-gray-700">
                    <span class="text-gray-400"><i class="fas fa-crosshairs mr-2"></i>Mode</span>
                    <span class="text-green-400 font-bold">Word-for-Word Precision</span>
                </div>
            </div>

            <button onclick="game.start()" class="group relative px-8 py-4 bg-cyan-500/10 hover:bg-cyan-500 text-cyan-400 hover:text-black font-bold rounded text-xl transition-all duration-300 border border-cyan-500 w-full">
                <span class="absolute inset-0 w-full h-full bg-cyan-400/20 blur opacity-0 group-hover:opacity-100 transition-opacity"></span>
                INITIALIZE QUIZ SEQUENCE
            </button>
        </div>
    </div>

    <!-- GAME SCREEN -->
    <div id="game-screen" class="hidden-screen flex-1 flex flex-col z-10 max-w-5xl mx-auto w-full p-4">
        
        <!-- HUD -->
        <div class="flex justify-between items-end mb-6 border-b border-gray-700 pb-4">
            <div>
                <p class="text-gray-400 text-sm mono mb-1">CURRENT MODULE</p>
                <h3 id="lesson-badge" class="text-xl font-bold text-purple-400">Lesson 6</h3>
            </div>
            <div class="text-center">
                <div class="text-3xl font-bold mono" id="score-display">0000</div>
                <div class="text-xs text-gray-500 tracking-widest">SYSTEM SCORE</div>
            </div>
            <div class="text-right">
                <div class="flex items-center gap-2 justify-end">
                    <span class="text-sm text-gray-400">COMBO</span>
                    <span id="streak-display" class="text-2xl font-bold text-yellow-400">x0</span>
                </div>
                <div class="h-1 w-24 bg-gray-800 rounded-full mt-1 ml-auto overflow-hidden">
                    <div id="streak-bar" class="h-full bg-yellow-400 w-0 transition-all duration-300"></div>
                </div>
            </div>
        </div>

        <!-- PROGRESS -->
        <div class="w-full bg-gray-800 h-2 rounded-full mb-8 overflow-hidden">
            <div id="progress-bar" class="progress-fill bg-cyan-500 h-full w-0"></div>
        </div>

        <!-- QUESTION CARD -->
        <div class="flex-1 flex flex-col justify-center">
            <div id="question-container" class="glass-panel p-8 rounded-xl border-l-4 border-cyan-500 relative min-h-[400px] flex flex-col justify-between">
                
                <div>
                    <div class="flex justify-between items-start mb-6">
                        <span class="bg-cyan-900/50 text-cyan-300 px-3 py-1 rounded text-sm border border-cyan-500/30 mono" id="q-counter">Q 1/40</span>
                        <span class="text-gray-500 text-xs mono" id="q-category">TOPIC: DECISION TREES</span>
                    </div>
                    
                    <h2 id="question-text" class="text-2xl md:text-3xl font-medium leading-relaxed mb-8">
                        Loading data stream...
                    </h2>
                </div>

                <div id="options-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Options injected by JS -->
                </div>

                <!-- Feedback Overlay -->
                <div id="feedback-overlay" class="absolute inset-0 flex items-center justify-center bg-black/80 backdrop-blur-sm rounded-xl opacity-0 pointer-events-none transition-opacity duration-300 z-20">
                    <div class="text-center transform scale-0 transition-transform duration-300" id="feedback-content">
                        <div id="feedback-icon" class="text-6xl mb-2"></div>
                        <div id="feedback-text" class="text-2xl font-bold uppercase tracking-widest"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- END SCREEN -->
    <div id="end-screen" class="hidden-screen flex-1 flex flex-col items-center justify-center z-10 p-6 overflow-y-auto">
        <div class="glass-panel max-w-3xl w-full p-8 rounded-2xl border border-gray-700 shadow-2xl my-8">
            <div class="text-center mb-8">
                <h2 class="text-4xl font-bold text-white mb-2">SESSION COMPLETE</h2>
                <p class="text-gray-400">Data Analysis Report</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-gray-900/50 p-6 rounded-lg border border-gray-700 text-center">
                    <div class="text-gray-500 text-sm mb-1">FINAL SCORE</div>
                    <div class="text-4xl font-bold text-cyan-400" id="final-score">0</div>
                </div>
                <div class="bg-gray-900/50 p-6 rounded-lg border border-gray-700 text-center">
                    <div class="text-gray-500 text-sm mb-1">ACCURACY</div>
                    <div class="text-4xl font-bold text-purple-400" id="final-accuracy">0%</div>
                </div>
                <div class="bg-gray-900/50 p-6 rounded-lg border border-gray-700 text-center">
                    <div class="text-gray-500 text-sm mb-1">BEST STREAK</div>
                    <div class="text-4xl font-bold text-yellow-400" id="final-streak">0</div>
                </div>
            </div>

            <div class="mb-8">
                <h3 class="text-xl font-bold mb-4 border-b border-gray-700 pb-2">Review Log (Incorrect Entries)</h3>
                <div id="review-list" class="space-y-3 max-h-60 overflow-y-auto pr-2 custom-scrollbar">
                    <!-- Incorrect answers populated here -->
                    <p class="text-gray-500 italic text-center">No errors detected. Perfect synchronization.</p>
                </div>
            </div>

            <button onclick="location.reload()" class="w-full py-4 bg-white text-black font-bold rounded hover:bg-cyan-400 transition-colors uppercase tracking-widest">
                Re-Initialize Protocol
            </button>
        </div>
    </div>

    <script>
        // --- DATA SOURCE ---
        // Extracted exactly from the provided PDF content.
        const studyData = [
            // Lesson 6: Decision Trees & Ensemble
            {
                lesson: "Lesson 6",
                topic: "Decision Trees",
                question: "What helps us to make decisions by mapping out different choices and their possible outcomes?",
                correct: "A Decision Tree",
                wrong: ["A Neural Network", "Linear Regression", "K-Means Clustering"]
            },
            {
                lesson: "Lesson 6",
                topic: "Decision Trees",
                question: "Why do decision trees matter? They are Intuitive & Transparent meaning:",
                correct: "Easy to visualize and understandâ€”even non-experts can follow the logic and explain predictions.",
                wrong: ["They use complex mathematical formulas impossible to visualize.", "They perform hidden calculations in a black box.", "They require extensive feature scaling to function."]
            },
            {
                lesson: "Lesson 6",
                topic: "Decision Tree Structure",
                question: "In the structure of a Decision Tree, what is the Root Node?",
                correct: "Starting point representing the whole dataset.",
                wrong: ["Points where decisions are made based on data features.", "End points of the tree where the final decision is made.", "Removal of subnodes at the end of every node."]
            },
            {
                lesson: "Lesson 6",
                topic: "Decision Tree Structure",
                question: "What are Internal Nodes?",
                correct: "Points where decisions are made based on data features.",
                wrong: ["Starting point representing the whole dataset.", "Lines connecting nodes showing the flow from one decision to another.", "End points of the tree where the final decision is made."]
            },
            {
                lesson: "Lesson 6",
                topic: "Decision Tree Structure",
                question: "What are Leaf Nodes?",
                correct: "End points of the tree where the final decision or prediction is made.",
                wrong: ["Removal of subnodes at the end of every node.", "Starting point representing the whole dataset.", "Points where decisions are made based on data features."]
            },
            {
                lesson: "Lesson 6",
                topic: "Decision Tree Structure",
                question: "What is Pruning?",
                correct: "Removal of subnodes at the end of every node.",
                wrong: ["Connecting nodes to show the flow of decisions.", "Splitting the data into subsets.", "Creating more branches to increase complexity."]
            },
            {
                lesson: "Lesson 6",
                topic: "Types of Trees",
                question: "What are Classification Trees used for?",
                correct: "Predicting categorical outcomes like spam or not spam.",
                wrong: ["Predicting continuous outcomes like house prices.", "Clustering data into unknown groups.", "Reducing the dimensionality of data."]
            },
            {
                lesson: "Lesson 6",
                topic: "Types of Trees",
                question: "What are Regression Trees used for?",
                correct: "Predicting continuous outcomes like predicting house prices.",
                wrong: ["Predicting categorical outcomes like spam or not spam.", "Assigning predefined categories to data.", "Creating visual maps of binary decisions."]
            },
            {
                lesson: "Lesson 6",
                topic: "Advantages",
                question: "Unlike many machine learning models, Decision Trees do not require us to:",
                correct: "Scale or normalize our data.",
                wrong: ["Split the data into training and test sets.", "Have a target variable.", "Use a computer for calculations."]
            },
            {
                lesson: "Lesson 6",
                topic: "Disadvantages",
                question: "What is Overfitting in Decision Trees?",
                correct: "They memorize the data instead of learning general patterns if they are too deep.",
                wrong: ["They fail to capture any patterns in the data.", "They become too shallow to make accurate predictions.", "They ignore the training data completely."]
            },
            {
                lesson: "Lesson 6",
                topic: "Disadvantages",
                question: "Decision Trees can be unstable, which means:",
                correct: "Small changes in the data may lead to significant differences in the tree structure and predictions.",
                wrong: ["Large changes in data have no effect on the tree.", "They crash the computer often.", "They always produce the same result regardless of data changes."]
            },
            {
                lesson: "Lesson 6",
                topic: "Disadvantages",
                question: "Decision Trees can become biased toward features with:",
                correct: "Many distinct values.",
                wrong: ["Very few distinct values.", "Binary values only.", "Continuous values only."]
            },
            {
                lesson: "Lesson 6",
                topic: "Ensemble Learning",
                question: "What is Ensemble Learning?",
                correct: "A method where we use many small models instead of just one.",
                wrong: ["A method where we use one giant model.", "A technique to reduce the amount of data needed.", "A way to visualize data points."]
            },
            {
                lesson: "Lesson 6",
                topic: "Ensemble Types",
                question: "In Bagging (Bootstrap Aggregating), models are trained:",
                correct: "Independently on different random subsets of the training data.",
                wrong: ["Sequentially, one after another.", "On the exact same dataset every time.", "Using different algorithms for each model."]
            },
            {
                lesson: "Lesson 6",
                topic: "Ensemble Types",
                question: "In Boosting, models are trained one after another. Each new model focuses on:",
                correct: "Fixing the errors made by the previous ones.",
                wrong: ["Confirming the correct predictions of the previous ones.", "Using a completely different dataset.", "Randomly guessing the outcome."]
            },
            {
                lesson: "Lesson 6",
                topic: "Random Forest",
                question: "Random Forest is a machine learning algorithm that:",
                correct: "Uses many decision trees to make better predictions.",
                wrong: ["Uses a single decision tree.", "Uses linear regression models.", "Uses neural networks only."]
            },
            {
                lesson: "Lesson 6",
                topic: "Random Forest",
                question: "When building each tree in a Random Forest, it picks a few features at random to decide how to split the data. This helps:",
                correct: "The trees stay different from each other.",
                wrong: ["The trees to be identical.", "To speed up the computer processor.", "To confuse the algorithm."]
            },
            {
                lesson: "Lesson 6",
                topic: "Boosting Algorithm",
                question: "Boosting combines multiple weak learners to create a:",
                correct: "Strong learner.",
                wrong: ["Weak learner.", "Neutral learner.", "Fast learner."]
            },
            {
                lesson: "Lesson 6",
                topic: "Boosting Algorithm",
                question: "In Boosting, misclassified examples receive:",
                correct: "Higher weights in the next iteration.",
                wrong: ["Lower weights in the next iteration.", "No weights in the next iteration.", "The same weights as correctly classified examples."]
            },
            {
                lesson: "Lesson 6",
                topic: "Techniques Summary",
                question: "Gradient Boosting Machines (GBM) sequentially builds decision trees, with each tree:",
                correct: "Correcting errors of the previous ones.",
                wrong: ["Working independently of the others.", "Ignoring the errors of the previous ones.", "Using a different dataset entirely."]
            },
            {
                lesson: "Lesson 6",
                topic: "Techniques Summary",
                question: "XGBoost (Extreme Gradient Boosting) does optimizations like:",
                correct: "Tree pruning, regularization and parallel processing.",
                wrong: ["Infinite looping and data duplication.", "Reducing feature count only.", "Manual data entry."]
            },
            {
                lesson: "Lesson 6",
                topic: "Techniques Summary",
                question: "CatBoost specializes in handling:",
                correct: "Categorical features natively without extensive preprocessing.",
                wrong: ["Image data natively.", "Audio files without preprocessing.", "Numerical features only."]
            },
            
            // Lesson 7: Collaborative Filtering
            {
                lesson: "Lesson 7",
                topic: "Recommendation Systems",
                question: "Collaborative Filtering recommends items based on:",
                correct: "Similarity measures between users and/or items.",
                wrong: ["Features of the item itself.", "A supervised classifier of interesting items.", "Random selection."]
            },
            {
                lesson: "Lesson 7",
                topic: "Recommendation Systems",
                question: "Content-Based Recommendation is supervised machine learning used to induce a classifier to:",
                correct: "Discriminate between interesting and uninteresting items for the user.",
                wrong: ["Find similar users.", "Group users into clusters.", "Predict the average rating of all users."]
            },
            {
                lesson: "Lesson 7",
                topic: "Collaborative Filtering",
                question: "In Collaborative Filtering, we classify the users into:",
                correct: "Clusters of similar types.",
                wrong: ["Groups based on age only.", "Alphabetical order.", "Random groups."]
            },
            {
                lesson: "Lesson 7",
                topic: "Data Processing",
                question: "In collaborative filtering, we round off the data to:",
                correct: "Compare it more easily.",
                wrong: ["Make the file size smaller.", "Hide the real ratings.", "Delete the data."]
            },
            {
                lesson: "Lesson 7",
                topic: "Data Processing",
                question: "Example of rounding data: we can assign below 3 ratings as:",
                correct: "0 and above of it as 1.",
                wrong: ["1 and above of it as 2.", "-1 and above of it as 0.", "5 and above of it as 10."]
            },
            {
                lesson: "Lesson 7",
                topic: "Normalizing",
                question: "In the process of normalizing, we take the average rating of a user and:",
                correct: "Subtract all the given ratings from it.",
                wrong: ["Add all the given ratings to it.", "Multiply it by the given ratings.", "Divide it by the total number of items."]
            },
            {
                lesson: "Lesson 7",
                topic: "Normalizing",
                question: "By normalizing the data, we get either positive or negative values, which can simply classify further into:",
                correct: "Similar groups.",
                wrong: ["Different datasets.", "Complex equations.", "Random clusters."]
            },

            // Lesson 8: KNN
            {
                lesson: "Lesson 8",
                topic: "KNN Basics",
                question: "KNN is non-parametric, meaning it makes:",
                correct: "No underlying assumptions about data distribution.",
                wrong: ["Many assumptions about data distribution.", "Assumptions that the data is linear.", "Assumptions that the data is normal."]
            },
            {
                lesson: "Lesson 8",
                topic: "KNN Basics",
                question: "Why is KNN called a 'lazy learner'?",
                correct: "It memorizes the entire dataset instead of explicit model training.",
                wrong: ["It takes a long time to learn.", "It ignores half the data.", "It only works on weekends."]
            },
            {
                lesson: "Lesson 8",
                topic: "KNN Basics",
                question: "Predictions in KNN are made by identifying and analyzing:",
                correct: "The 'K' closest data points to a new, unclassified input.",
                wrong: ["The furthest data points from the input.", "The average of the entire dataset.", "The random data points in the set."]
            },
            {
                lesson: "Lesson 8",
                topic: "KNN Basics",
                question: "KNN operates on a fundamental principle that:",
                correct: "Similar things exist in close distance within a feature space.",
                wrong: ["Similar things are far apart.", "Dissimilar things are close together.", "Distance does not matter."]
            },
            {
                lesson: "Lesson 8",
                topic: "Distance Metrics",
                question: "Euclidean distance is defined as:",
                correct: "The straight-line distance between two points in a plane or space.",
                wrong: ["The distance along a grid.", "The taxicab distance.", "The infinite distance between points."]
            },
            {
                lesson: "Lesson 8",
                topic: "Distance Metrics",
                question: "Manhattan Distance is also called:",
                correct: "'Taxicab distance'.",
                wrong: ["'Airplane distance'.", "'Subway distance'.", "'Teleportation distance'."]
            },
            {
                lesson: "Lesson 8",
                topic: "Distance Metrics",
                question: "Why the Absolute Value in Manhattan Distance?",
                correct: "Ensures that the distance is always positive, regardless of the direction.",
                wrong: ["Ensures the distance is always negative.", "Makes the calculation harder.", "Rounds the number to the nearest integer."]
            },
            {
                lesson: "Lesson 8",
                topic: "Distance Metrics",
                question: "Minkowski Distance is like a family of distances, where when p=1 it is:",
                correct: "Manhattan.",
                wrong: ["Euclidean.", "Hamming.", "Chebyshev."]
            },
            {
                lesson: "Lesson 8",
                topic: "Distance Metrics",
                question: "Minkowski Distance is like a family of distances, where when p=2 it is:",
                correct: "Euclidean.",
                wrong: ["Manhattan.", "Hamming.", "Chebyshev."]
            },
            {
                lesson: "Lesson 8",
                topic: "KNN Process",
                question: "In KNN Classification, the algorithm picks the category that:",
                correct: "Appears the most (majority voting).",
                wrong: ["Appears the least.", "Has the highest numerical value.", "Is alphabetically first."]
            },
            {
                lesson: "Lesson 8",
                topic: "KNN Process",
                question: "In KNN Regression, instead of voting, it takes:",
                correct: "The average of the values of those K neighbors.",
                wrong: ["The median of the values.", "The highest value only.", "The lowest value only."]
            },
            {
                lesson: "Lesson 8",
                topic: "Disadvantages",
                question: "What is the 'Curse of Dimensionality' in KNN?",
                correct: "Performance degrades significantly with high-dimensional data as distances become less meaningful.",
                wrong: ["Performance improves with more dimensions.", "The code becomes cursed and stops working.", "It requires 3D glasses to view the data."]
            },
            {
                lesson: "Lesson 8",
                topic: "Disadvantages",
                question: "KNN requires data normalization or standardization because:",
                correct: "It is sensitive to feature scaling.",
                wrong: ["It is not sensitive to feature scaling.", "It prefers raw data.", "It cannot handle numbers."]
            }
        ];

        // --- GAME LOGIC ---

        class QuizGame {
            constructor(data) {
                this.fullData = data;
                this.questions = [];
                this.currentIndex = 0;
                this.score = 0;
                this.streak = 0;
                this.maxStreak = 0;
                this.incorrectAnswers = [];
                
                // DOM Elements
                this.screens = {
                    start: document.getElementById('start-screen'),
                    game: document.getElementById('game-screen'),
                    end: document.getElementById('end-screen')
                };
                
                this.ui = {
                    questionText: document.getElementById('question-text'),
                    optionsGrid: document.getElementById('options-grid'),
                    score: document.getElementById('score-display'),
                    streak: document.getElementById('streak-display'),
                    streakBar: document.getElementById('streak-bar'),
                    progress: document.getElementById('progress-bar'),
                    counter: document.getElementById('q-counter'),
                    category: document.getElementById('q-category'),
                    lessonBadge: document.getElementById('lesson-badge'),
                    feedback: {
                        overlay: document.getElementById('feedback-overlay'),
                        content: document.getElementById('feedback-content'),
                        icon: document.getElementById('feedback-icon'),
                        text: document.getElementById('feedback-text')
                    }
                };
            }

            start() {
                // Shuffle and prep questions
                this.questions = this.shuffleArray([...this.fullData]);
                this.currentIndex = 0;
                this.score = 0;
                this.streak = 0;
                this.maxStreak = 0;
                this.incorrectAnswers = [];

                // UI Reset
                this.switchScreen('game');
                this.updateHUD();
                this.loadQuestion();
            }

            switchScreen(screenName) {
                Object.values(this.screens).forEach(s => s.classList.add('hidden-screen'));
                this.screens[screenName].classList.remove('hidden-screen');
            }

            shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            loadQuestion() {
                const q = this.questions[this.currentIndex];
                
                // Animate text entry
                this.ui.questionText.innerHTML = q.question;
                this.ui.category.innerText = `TOPIC: ${q.topic.toUpperCase()}`;
                this.ui.lessonBadge.innerText = q.lesson;
                this.ui.counter.innerText = `Q ${this.currentIndex + 1}/${this.questions.length}`;

                // Prepare Options
                let options = [...q.wrong];
                // Ensure unique wrong answers if duplicates exist in data (rare but safe)
                options = [...new Set(options)]; 
                // Slice to 3 wrong answers max if more exist, though data has 3
                options = options.slice(0, 3);
                
                // Add correct answer
                options.push(q.correct);
                
                // Shuffle options
                options = this.shuffleArray(options);

                // Render Options
                this.ui.optionsGrid.innerHTML = '';
                options.forEach((opt, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn w-full p-6 text-left rounded-lg text-lg font-medium animate-slide-in';
                    btn.style.animationDelay = `${index * 0.1}s`;
                    btn.dataset.answer = opt;
                    btn.innerHTML = `<span class="text-cyan-500 font-bold mr-3">${String.fromCharCode(65 + index)}.</span> ${opt}`;
                    btn.onclick = () => this.handleAnswer(opt, btn);
                    this.ui.optionsGrid.appendChild(btn);
                });

                // Update Progress
                const progressPct = (this.currentIndex / this.questions.length) * 100;
                this.ui.progress.style.width = `${progressPct}%`;
            }

            handleAnswer(selected, btnElement) {
                // Prevent double clicking
                const buttons = this.ui.optionsGrid.querySelectorAll('button');
                buttons.forEach(b => b.disabled = true);

                const currentQ = this.questions[this.currentIndex];
                const isCorrect = selected === currentQ.correct;

                if (isCorrect) {
                    btnElement.classList.add('correct');
                    this.handleCorrect();
                } else {
                    btnElement.classList.add('wrong');
                    // Highlight correct answer
                    buttons.forEach(b => {
                        if (b.dataset.answer === currentQ.correct) b.classList.add('correct');
                    });
                    this.handleWrong(currentQ);
                }

                // Delay for next question
                setTimeout(() => {
                    this.nextQuestion();
                }, 1500);
            }

            handleCorrect() {
                this.streak++;
                if (this.streak > this.maxStreak) this.maxStreak = this.streak;
                const multiplier = 1 + (Math.floor(this.streak / 5) * 0.5);
                const points = Math.round(100 * multiplier);
                this.score += points;
                
                this.showFeedback(true);
                this.updateHUD();
            }

            handleWrong(question) {
                this.streak = 0;
                this.incorrectAnswers.push(question);
                this.showFeedback(false);
                this.updateHUD();
            }

            showFeedback(isCorrect) {
                const { overlay, content, icon, text } = this.ui.feedback;
                
                overlay.style.opacity = '1';
                overlay.style.pointerEvents = 'auto';
                content.style.transform = 'scale(1)';
                
                if (isCorrect) {
                    icon.innerHTML = '<i class="fas fa-check-circle text-green-400"></i>';
                    text.innerText = 'CORRECT';
                    text.className = 'text-2xl font-bold uppercase tracking-widest text-green-400';
                    icon.classList.remove('glitch');
                } else {
                    icon.innerHTML = '<i class="fas fa-times-circle text-red-500"></i>';
                    text.innerText = 'ERROR';
                    text.className = 'text-2xl font-bold uppercase tracking-widest text-red-500';
                    icon.classList.add('glitch');
                }

                setTimeout(() => {
                    overlay.style.opacity = '0';
                    content.style.transform = 'scale(0)';
                    overlay.style.pointerEvents = 'none';
                }, 1000);
            }

            updateHUD() {
                // Score count up animation
                const currentDisplay = parseInt(this.ui.score.innerText);
                this.animateValue(this.ui.score, currentDisplay, this.score, 500);

                this.ui.streak.innerText = `x${this.streak}`;
                
                // Streak bar fill (caps at 10)
                const fillPct = Math.min(this.streak * 10, 100);
                this.ui.streakBar.style.width = `${fillPct}%`;
                
                if (this.streak >= 5) {
                    this.ui.streak.classList.add('neon-text');
                    this.ui.streak.style.color = '#0aff0a';
                } else {
                    this.ui.streak.classList.remove('neon-text');
                    this.ui.streak.style.color = '#facc15'; // yellow
                }
            }

            animateValue(obj, start, end, duration) {
                let startTimestamp = null;
                const step = (timestamp) => {
                    if (!startTimestamp) startTimestamp = timestamp;
                    const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                    obj.innerHTML = Math.floor(progress * (end - start) + start);
                    if (progress < 1) {
                        window.requestAnimationFrame(step);
                    }
                };
                window.requestAnimationFrame(step);
            }

            nextQuestion() {
                this.currentIndex++;
                if (this.currentIndex < this.questions.length) {
                    this.loadQuestion();
                } else {
                    this.endGame();
                }
            }

            endGame() {
                this.switchScreen('end');
                document.getElementById('final-score').innerText = this.score;
                
                const accuracy = Math.round(((this.questions.length - this.incorrectAnswers.length) / this.questions.length) * 100);
                document.getElementById('final-accuracy').innerText = `${accuracy}%`;
                
                // Calculate best streak (This is a simplified tracking, usually you track max during game)
                // For now showing current streak or if perfect, total.
                // Let's just show the final streak as it adds "pressure" to maintain it till the end.
                document.getElementById('final-streak').innerText = this.maxStreak;

                // Populate Review List
                const list = document.getElementById('review-list');
                list.innerHTML = '';
                
                if (this.incorrectAnswers.length === 0) {
                    list.innerHTML = '<div class="text-green-400 text-center p-4 border border-green-500/30 rounded bg-green-500/10">PERFECT SCORE - SYSTEM OPTIMIZED</div>';
                } else {
                    this.incorrectAnswers.forEach(q => {
                        const item = document.createElement('div');
                        item.className = 'bg-red-500/10 p-4 rounded border border-red-500/30';
                        item.innerHTML = `
                            <div class="text-xs text-red-300 mb-1">${q.lesson} - ${q.topic}</div>
                            <div class="font-medium mb-2">${q.question}</div>
                            <div class="text-sm text-green-400"><i class="fas fa-check mr-2"></i>${q.correct}</div>
                        `;
                        list.appendChild(item);
                    });
                }
            }
        }

        // Initialize
        const game = new QuizGame(studyData);

    </script>
</body>
</html>